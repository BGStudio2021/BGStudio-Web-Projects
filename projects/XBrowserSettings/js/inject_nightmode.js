var CURRENT_VIDEO,CURRENT_ELEMENT,LAST_HIT_ELEMENT,SELECTED_ELEMENT,g_f_exec_command,g_f_cb_write_text,g_f_cb_write,has_submit,g_timer,call_timeout,LINK_ELEMENT_ID="x_link_element_id",STYLE_ELEMENT_ID="x_style_element_id",LINK_EXTRA_CSS_ID="x_link_extra_css_id",STYLE_EXTRA_CSS_ID="x_style_extra_css_id",g_element_rules=null,g_max_ad_container_height=320,g_min_ad_container_height=20,g_hit_rules=[],g_auto_fill_keywords=["pass","name","usr","user","addr","mail","nick","phone","account","phone","用户","手机","邮箱","地址","账号","昵称","密码"],g_fill_form_data={},last_point={left:0,top:0},video_gesture_mode=!1,seek_to=-1,g_dom_load_finished=!1,g_page_load_finished=!1,g_rule_try_times=5,in_selection=!1,last_touch_a_element=null,try_sniff_times=0;function applyOuterCSS(){var e,t;console.log(">>>>>>>>>>>>> start excute applyOuterCSS"),document.getElementById(LINK_ELEMENT_ID)||29<=mbrowser.getSdkLevel()&&!mbrowser.inGoodForEyeMode()||(e=mbrowser.getInjectCss(),css=document.createElement("link"),css.id=LINK_ELEMENT_ID,css.rel="stylesheet",css.href=e,0<(t=document.getElementsByTagName("head")).length&&t[0].appendChild(css),document.getElementById(STYLE_ELEMENT_ID)||((t=document.createElement("style")).type="text/css",t.rel="stylesheet",t.id=STYLE_ELEMENT_ID,t.appendChild(document.createTextNode(e)),null!=document.documentElement&&document.documentElement.appendChild(t)))}function appExtraCss(){var e,t;document.getElementById(LINK_EXTRA_CSS_ID)||(e="data:text/css,html,body,a,div,p,img,textarea{-webkit-touch-callout:text !important;-webkit-user-select:text !important;user-select:text !important;}",css=document.createElement("link"),css.id=LINK_EXTRA_CSS_ID,css.rel="stylesheet",css.href=e,0<(t=document.getElementsByTagName("head")).length&&t[0].appendChild(css),document.getElementById(STYLE_EXTRA_CSS_ID)||((t=document.createElement("style")).type="text/css",t.rel="stylesheet",t.id=STYLE_EXTRA_CSS_ID,t.appendChild(document.createTextNode(e)),null!=document.documentElement&&document.documentElement.appendChild(t)))}function remove_script(e){for(var t=e.querySelectorAll("script"),n=0;n<t.length;n++){var o=t[n];o.parentNode&&o.parentNode.removeChild(o)}}function remove_style(e){for(var t=e.querySelectorAll("style"),n=0;n<t.length;n++){var o=t[n];o.parentNode&&o.parentNode.removeChild(o)}}function view_source(){var e=document.documentElement.outerHTML;mbrowser.viewSource(e)}function save_source(){var e=document.documentElement,e=(remove_script(e),e.outerHTML);mbrowser.saveSource(e)}function save_text(){var e=extract_content_node();e=(null!=e?e:document.documentElement).innerText,mbrowser.saveText(e)}function disableOuterCSS(){var e=document.getElementById(LINK_ELEMENT_ID),e=(e&&e.parentNode.removeChild(e),document.getElementById(STYLE_ELEMENT_ID));e&&e.parentNode.removeChild(e)}function notifyHitTest(e,t){var n={};n.tagType=e,n.src=t,mbrowser.onElementHitTest(JSON.stringify(n))}function _getTop(e){var t=e.offsetTop;return null!=e.offsetParent&&(t+=_getTop(e.offsetParent)),t}function _getLeft(e){var t=e.offsetLeft;return null!=e.offsetParent&&(t+=_getLeft(e.offsetParent)),t}function _setCookie(e,t){var n;t&&((n=new Date).setTime(n.getTime()+864e5),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString)}function _getCookie(e){var e=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(e=document.cookie.match(e))?unescape(e[2]):null}function native_call_fetch_image_res(){for(var e=document.querySelectorAll("img"),t=0;t<e.length;t++){var n,o=e[t];(200<=o.width&&100<=o.height||200<=o.height)&&((n=o.parentNode)&&"a"==n.tagName.toLowerCase()&&(0<n.href.indexOf(".png")||0<n.href.indexOf(".jpg"))?mbrowser.addImageRes("",n.href):0<=o.src.indexOf("data:image")||mbrowser.addImageRes(o.alt,o.src))}}function native_call_add_tag_to_resource(){for(var e=document.querySelectorAll("img"),t=0;t<e.length;t++)mbrowser.addTagToResource(e[t].src,"img");for(var n=document.querySelectorAll("script"),t=0;t<n.length;t++)mbrowser.addTagToResource(n[t].src,"js");for(var o=document.querySelectorAll("link"),t=0;t<o.length;t++){var r=o[t].href;0<r.indexOf("ico")||0<r.indexOf("png")||0<r.indexOf("jpg")?mbrowser.addTagToResource(o[t].href,"img"):(console.log("resource-url:>>>>>>>"+o[t].href),mbrowser.addTagToResource(o[t].href,"css"))}for(var l=document.querySelectorAll("video"),t=0;t<l.length;t++)mbrowser.addTagToResource(l[t].src,"video");for(var a=document.querySelectorAll("audio"),t=0;t<a.length;t++)mbrowser.addTagToResource(a[t].src,"audio")}function native_call_sniff_media_res(c){try{for(var e=document.querySelectorAll("video"),t=0;t<e.length;t++){var n=e[t];bind_video_events(n),mbrowser.addTagToResource(n.src,"video")}for(var o=document.querySelectorAll("iframe"),r=0;r<o.length;r++){var l,a=o[r];a.contentDocument&&((l=a.contentDocument.querySelector("video"))&&bind_video_events(l))}for(var i=document.querySelectorAll("audio"),t=0;t<i.length;t++)mbrowser.addTagToResource(i[t].src,"audio");for(var s=document.querySelectorAll("link"),t=0;t<s.length;t++){var _=s[t].href;(0<_.endsWith(".m3u8")||0<_.endsWith(".mp4"))&&mbrowser.addTagToResource(s[t].href,"video")}}catch(e){}mbrowser.notifySniffMediaRes(c)}function nav_call_download_blob(e,t){alert(e);const n=document.createElement("a");n.download=t,n.style.display="none",n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function nav_call_decode_blob(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Content-type",""),t.responseType="blob",console.log(">>>>>>> nav_call_decode_blob:"+e),t.onreadystatechange=function(){alert("ok:"+t.statusText+" status:"+t.status+" state:"+t.readyState)},t.onload=function(e){200==this.status?alert("ok"):alert("fail")},t.send()}function get_client_height(){return(document.body.clientHeight&&document.documentElement.clientHeight?document.body.clientHeight<document.documentElement.clientHeight?document.body:document.documentElement:document.body.clientHeight>document.documentElement.clientHeight?document.body:document.documentElement).clientHeight}function is_touch_on_element(e,t,n){var o,r,l;return console.log("is_touch_on_element>>>tagName:"+e.tagName+"clientHeight:"+e.clientHeight),!(!e||!e.offsetHeight)&&(r=(o=_getLeft(e))+e.clientWidth,e=(l=_getTop(e))+e.clientHeight,console.log("x:"+t+" y:"+n),o<=t&&t<=r&&l<=n&&n<=e)}function showMessageOnNative(e,t){try{mbrowser.showFloatMessageBox(e,t)}catch(e){}}function cleanNativeMessage(){try{mbrowser.dismissFloatMessageBox()}catch(e){}}function on_touch_video_element(){video_gesture_mode=!0,mbrowser.setBrowserState(1)}function on_off_video_element(){video_gesture_mode=!1,mbrowser.setBrowserState(0)}function tranx_has_set(e){if(e.style){var t=(t=e.style.transform)||e.style.webkitTransform;if(t&&(console.log("###can transform"+e.style.transform+" webkit-tran:"+e.style.webkitTransform),t.indexOf("(0px,")<0))return console.log(">>>> element has trans........."),!0}return!1}function checkChildCanSwipe(e){console.log(">>>###  do check target tran:"+e.tagName+" class:"+tagName.class);var t=!1;if(tranx_has_set(e))return!0;for(var n=0;n<e.childElementCount;n++)if(t=checkChildCanSwipe(e.children[n]))break;return t}function bind_li_data(e,t){if(e){for(;e.parentNode&&(console.log(">>>> touch tag name:"+e.tagName),!e.tagName||"li"!=e.tagName.toLowerCase());)e=e.parentNode;e.tagName&&"li"==e.tagName.toLowerCase()&&(t.tagType="li",t.li_id=e.getAttribute("id"),t.data_url=e.getAttribute("data-url"),t.data_title=e.getAttribute("data-title"),t.data_type=e.getAttribute("data-type"),t.data_status=e.getAttribute("data-status"),notify_got_hit_data(t))}}function notify_got_hit_data(e){mbrowser.onElementHitTest(JSON.stringify(e))}function do_hit(e,t,n){var o=n.tagName.toLowerCase(),r={};if("img"==o)r.source="normal",r.tagType="img",r.src=n.src,notify_got_hit_data(r);else if(0<=document.location.href.indexOf("file:///android_asset"))try{bind_li_data(n,r)}catch(e){console.log("catch bind_li_data error"+e.toString())}("a"==o||n.parentElement&&"a"==n.parentElement.tagName.toLowerCase())&&mbrowser.onTouchEventElement()}function check_swipe_element(e){if(mbrowser.elementCanSwipe(!1),"iframe"==e.tagName.toLowerCase())try{checkChildCanSwipe(e.contentDocument)&&mbrowser.elementCanSwipe(!0)}catch(e){mbrowser.elementCanSwipe(!0),console.log(e.message)}else{var t=e.className;for(t&&0<=t.indexOf("feed-slider")&&mbrowser.elementCanSwipe(!0);e.parentNode;){if(tranx_has_set(e)){mbrowser.elementCanSwipe(!0);break}e=e.parentNode}}console.log("windows.scrollX:"+window.scrollX),0<window.scrollX&&mbrowser.elementCanSwipe(!0)}function clean_video_control_style(){var e=document.getElementById("video-style-control");e&&e.parentElement&&e.parentElement.removeChild(e)}function pause_or_play(){CURRENT_VIDEO&&(CURRENT_VIDEO.paused?CURRENT_VIDEO.play():CURRENT_VIDEO.pause())}function set_video_seek(e){CURRENT_VIDEO&&(CURRENT_VIDEO.currentTime=e)}function native_call_change_video_seek(e){CURRENT_VIDEO&&(CURRENT_VIDEO.currentTime=e)}function play_with_fullscreen(){CURRENT_VIDEO&&CURRENT_VIDEO.webkitRequestFullScreen()}function notify_video_play(e){CURRENT_VIDEO=e.target,mbrowser.notifyVideoPlayed(CURRENT_VIDEO.src,CURRENT_VIDEO.duration,CURRENT_VIDEO.currentTime,CURRENT_VIDEO.volume,CURRENT_VIDEO.currentSrc)}function notify_video_load(e){var t=e.target.src;t&&""!=t||(t=e.target.querySelector("source").src),mbrowser.notifyVideoLoad(t,e.target.duration)}function notify_time_update(e){mbrowser.notifyVideoTimeUpdate(e.target.currentTime,e.target.duration)}function notify_video_paused(e){mbrowser.notifyVideoPaused()}function notify_video_load_start(){console.log("========= video load start =============")}function notify_video_waiting(){console.log("========= video load waitting =============")}function notify_video_seeking(){console.log("========= video load seeking =============")}function bind_video_events(e){e.addEventListener("play",notify_video_play),e.addEventListener("loadedmetadata",notify_video_load),e.addEventListener("timeupdate",notify_time_update),e.addEventListener("pause",notify_video_paused),CURRENT_VIDEO=e}function sniff_video(){var e,t,n=!1;try{var o=document.querySelectorAll("video");console.log("sniff-video >>>> found :"+o.length+" videos");for(var r=0;r<o.length;r++)bind_video_events(o[r]),n=!0;for(var l=document.querySelectorAll("iframe"),a=0;a<l.length;a++){var i,s=l[a];s.contentDocument&&((i=s.contentDocument.querySelector("video"))&&(bind_video_events(i),n=!0))}}catch(e){console.log(e)}n&&((e=CURRENT_VIDEO.src)&&""!=e||(t=CURRENT_VIDEO.querySelector("source"))&&(e=t.src),e&&(console.log("sniff-video >>>> video url :"+e),mbrowser.notifyHasVideoTag(e))),try_sniff_times++}function show_video_url(){CURRENT_VIDEO&&(mylog("CURRENT_VIDEO URL:"+CURRENT_VIDEO.src),mylog("CURRENT_VIDEO CURRENT URL:"+CURRENT_VIDEO.currentSrc))}function native_call_update_play_speed(e){CURRENT_VIDEO?(mylog("UPDATE VIDE SPEED:"+e),CURRENT_VIDEO.playbackRate=e):mylog(">>>NO FOUND VIDEO:"+e)}function cancel_select(){var e;window.getSelection().removeAllRanges(),mylog(">>>>>>> exit select state >>>>>>>>>>>"),last_touch_a_element&&(e=last_touch_a_element.getAttribute("_href"),last_touch_a_element.removeAttribute("_href"),e&&last_touch_a_element.setAttribute("href",e))}function get_a_element_by_touch(e){var t;return 1==e.nodeType?null!=(t=e.querySelector("a"))?t:"a"==e.tagName.toLowerCase()?e:(t=e.parentNode)?get_a_element_by_touch(t):null:(t=e.parentNode)?get_a_element_by_touch(t):null}function get_text_elemt(e){if(3==e.nodeType)return e.parentNode;for(var t=e.childNodes,n=0;n<t.length;n++){var o=t[n],o=(mylog(">>>>> travel child: "+o.nodeName),get_text_elemt(o));if(null!=o)return o}return null}function select_text2(e,t,n,o){e*=window.innerWidth/o,o=t*(window.innerHeight/n),t=document.elementFromPoint(e,o),n=window.getSelection();n.removeAllRanges(),n.selectAllChildren(t)}function select_text(e,t,n,o){o=e*(window.innerWidth/o),n=t*(window.innerHeight/n),window.innerWidth,window.innerHeight,o=document.elementFromPoint(o,n),n=o.tagName.toLowerCase();if(mylog("########### try rewrite href element:#########"+o.tagName+" class:"+o.className),last_touch_a_element=get_a_element_by_touch(o)){var o=last_touch_a_element.getAttribute("href");if(o&&(last_touch_a_element.removeAttribute("href"),last_touch_a_element.setAttribute("_href",o)),"img"==n)return o=get_text_elemt(last_touch_a_element),(n=window.getSelection()).removeAllRanges(),void n.selectAllChildren(o)}else mylog(">>>>>>>>>>>>>>> not found a elements ");mbrowser.sendLongPress(e,t)}function get_main_domain(e){var t=e,n=e.indexOf("://"),e=(t=0<n?e.substring(n+3):t).indexOf("."),n=t.lastIndexOf("."),o=t.indexOf("/");return n==e?t:0<o?t.substring(e+1,o):t.substring(e+1)}function native_touch_to_element(e,t,n,o){return e*=window.innerWidth/o,t*=window.innerHeight/n,last_point.left=e,last_point.top=t,document.elementFromPoint(e,t)}function hit_swipe_element(e,t,n,o){check_swipe_element(native_touch_to_element(e,t,n,o))}function hit_test(e,t,n,o){n=native_touch_to_element(e,t,n,o);n?(mylog("hit-test:x:"+e+" y:"+t+" target:"+n.tagName),do_hit(e,t,n),is_mark_able_element(o=find_fit_element(CURRENT_ELEMENT=n))?(CURRENT_ELEMENT=o,mbrowser.setHitElementMarkable()):CURRENT_ELEMENT=n,LAST_HIT_ELEMENT=CURRENT_ELEMENT):console.log(">>>>>>>>>>>>>> No corresponding element found. ("+e+","+t+") >>>>>>>>>>>>>>>")}function clean_selected_state(){var e=document.querySelector("#x_select_state_mask");e&&e.parentElement.removeChild(e)}function show_select_state(e){var t;e&&((t=document.createElement("div")).id="x_select_state_mask",t.style.width=e.offsetWidth+"px",t.style.height=e.offsetHeight+"px",t.style.background="RED",t.style.opacity="0.3",t.style.position="absolute",t.style.display="block",t.style.top="0px",t.style.left="0px",t.style.zIndex=2147483647,e.appendChild(t))}function set_selected_state(e,t){t?(e.old_style=e.getAttribute("style"),e.style=e.old_style+";opacity:0.3;background-color:red;padding:2px"):e.old_style?e.setAttribute("style",e.old_style):e.setAttribute("style","")}function do_execute_rule(e){mylog("==================  start execute rule :"+e+"=====================");var t=e,n=e.indexOf("->"),o=0,c=0,d=0,u=0,m=0,r=0,f=!1,g=(0<n&&((a=e.substring(n+2))&&0<=a.indexOf("m")&&(f=!0),0<a.indexOf(":")?(i=a.split(":"),a.indexOf("m")<0?(c=parseInt(i[0]),d=parseInt(i[1]),u=parseInt(i[2]),m=parseInt(i[3])):(g=parseInt(0),c=parseInt(i[1]),d=parseInt(i[2]),u=parseInt(i[3]),m=parseInt(i[4]),"m"==g&&(f=!0),r=2)):(o=parseInt(a),r=1),t=e.substring(0,n)),t),l=document.querySelectorAll(t);if(0<l.length)if(1<l.length&&(0<d||0<c))r=2;else{if(0<o&&l.length<o)return;r=0<o?1:0}if(f&&0==l.length){var a="",i=t.indexOf("#"),n=t.indexOf("."),o=t.indexOf("[");if((0<i&&o<0||0<i&&i<o)&&(a=t.substring(0,i)),i<0&&0<n&&(o<0||n<o)&&(a=t.substring(0,n)),i<0&&n<0&&0<o&&(a=t.substring(0,o)),0<n&&n<o&&(t=a+(t=t.substring(n)))!=g&&(mylog(">>>>>>>>> try selector 1:"+t+">>>>>>>>>>>>"),l=document.querySelectorAll(t)),0==l.length&&0<o&&((t=a+(i=g.substring(o)))!=g&&(mylog(">>>>>>>>> try selector 2:"+t+">>>>>>>>>>>>"),l=document.querySelectorAll(t)),0==l.length&&i&&(mylog(">>>>>>>>> try selector 3:"+(t=i)+">>>>>>>>>>>>"),l=document.querySelectorAll(i))),0==l.length&&a&&2==r&&(mylog(">>>>>>>>> try selector 4:"+(t=a)+">>>>>>>>>>>>"),l=document.querySelectorAll(t)),0==r&&3<=l.length||50<l.length)return}mylog(">>>>>>>>>>debug-rule:"+t+" left:"+c+" top:"+d+" type "+r+" element len "+l.length+" is mark rule:"+f);for(var E=0;E<l.length;E++){var s=l[E];if(s&&1==s.nodeType){var _=s.parentElement;if(_)if(1==r&&"a"==_.tagName.toLowerCase()){var h=_.href,p=get_main_domain(window.location.host);0<=h.indexOf("http")&&h.indexOf(p)<0&&_.removeChild(s)}else if(2==r){var h=_getLeft(s),p=_getTop(s),v=s.offsetWidth,y=s.offsetHeight;if(mylog(">>>> TAG:"+s.tagName+" _top:"+p+" _left:"+h+" _w:"+v+" _h:"+y),Math.abs(h-c)<30&&Math.abs(p-d)<30&&v==u&&y==m){mylog("found  hit ad by selector "+t+" tagName:"+s.tagName),_.removeChild(s);break}}else s.remove(),mylog("found  hit ad by selector "+t+" tagName:"+s.tagName+"parent"+_.tagName)}}0<l.length&&add_hit_rule(e)}function execute_element_rules(){var e=document.location.host;console.time("load-element-rule-cost-time"),g_element_rules=g_element_rules||JSON.parse(mbrowser.getElementRules(e)),console.timeEnd("load-element-rule-cost-time"),console.log("======  total ["+g_element_rules.length+"] element rule  ====== ("+e+")"),console.time("execute-element-rule-cost-time");for(var t=0;t<g_element_rules.length;t++){var n=g_element_rules[t];mylog("=========== execute rule:"+n+"================");try{0<n.indexOf("->m")&&is_hit_rule(n),do_execute_rule(n)}catch(e){mylog(">>>>>>>>>>>>>>"+e)}}console.timeEnd("execute-element-rule-cost-time")}function is_hit_rule(e){var t=0;return t<g_hit_rules.length&&g_hit_rules[t]==e}function add_hit_rule(e){g_hit_rules.push(e),mbrowser.logBlockOneAd(window.location.href,window.location.host,e,3)}function execute_mark_rules(){console.time("load-element-rule-cost-time"),g_element_rules=g_element_rules||JSON.parse(mbrowser.getElementRules(host)),console.timeEnd("load-element-rule-cost-time"),console.time("execute-user-mark-rule-cost-time");for(var e=0;e<g_element_rules.length;e++){var t=g_element_rules[e];if(0<t.indexOf("->m")&&!is_hit_rule(t))try{do_execute_rule(t)}catch(e){mylog(">>>>>>>>>>>>>>"+e)}}console.timeEnd("execute-user-mark-rule-cost-time")}function cancel_marked_element(){SELECTED_ELEMENT&&(set_selected_state(SELECTED_ELEMENT,!1),SELECTED_ELEMENT=null)}function adjustment_area(){CURRENT_ELEMENT?(CURRENT_ELEMENT=0<CURRENT_ELEMENT.childElementCount?(mbrowser.log(">>>>>>>> fist child :"+CURRENT_ELEMENT.firstElementChild.tagName),CURRENT_ELEMENT.firstElementChild):CURRENT_ELEMENT.nextElementSibling||LAST_HIT_ELEMENT,update_element_state()):mbrowser.log(">>>>> SELECTED ELEMENT IS NULL >>>>>")}function test_rule(){mylog(" >>>>> test elements "+document.querySelectorAll("div[style='overflow: hidden; background: rgb(255, 255, 255);']").length)}function gen_element_rule(e){for(var t="",n=e.id,o="",c=window.location.host,d=e.tagName,u=e.getAttributeNames(),r="",l="",a=0;a<e.classList.length;a++)o+="."+e.classList.item(a);for(var i=0;i<u.length;i++){var m,f=!1,g=!0,s=u[i],_=e.getAttribute(s);"class"!=s&&"id"!=s&&"title"!=s&&("style"==s&&!_||(_||(g=!1),!(0<=s.indexOf("src")||0<=s.indexOf("href")||0<=s.indexOf("source"))||0<(m=_.indexOf("?"))&&(_=_.substring(0,m),f=!0),l+=g?f?"["+s+"^='"+_+"']":"["+s+"='"+_+"']":"["+s+"]"))}d&&(r+=d),n&&(r+="#"+n),o&&(r+=o),l&&(r+=l);document.querySelectorAll(r);t=c?c+"##"+r:"##"+r;return t+="->m:"+_getLeft(e)+":"+_getTop(e)+":"+e.offsetWidth+":"+e.offsetHeight}function commit_marked_element(){var e,t;SELECTED_ELEMENT&&(set_selected_state(e=SELECTED_ELEMENT,!1),mylog(">>>> gen rule:"+(t=gen_element_rule(SELECTED_ELEMENT))+" parent:"+e.parentElement.tagName),mbrowser.addAdBlockRule(t,window.location.host,document.location.href,3),(e.parentElement||document).removeChild(e),SELECTED_ELEMENT=null)}function update_element_state(){mbrowser.isInMarkAdMode()&&(SELECTED_ELEMENT?SELECTED_ELEMENT==CURRENT_ELEMENT?(set_selected_state(SELECTED_ELEMENT,!1),SELECTED_ELEMENT=null):(set_selected_state(SELECTED_ELEMENT,!1),set_selected_state(SELECTED_ELEMENT=CURRENT_ELEMENT,!0)):set_selected_state(SELECTED_ELEMENT=CURRENT_ELEMENT,!0))}function is_mark_able_element(e){e.innerText.trim().length;var t=e.querySelector("input");return e.offsetHeight<g_max_ad_container_height&&"p"!=e.tagName.toLowerCase()&&null==t}function find_fit_element(e){for(;null!=e.parentElement&&e.parentElement.offsetHeight<g_max_ad_container_height;)e.parentElement,e=e.parentElement;if(0==e.offsetHeight&&0<e.children.length)for(var t=0;t<e.children.length;t++){var n=e.children[t];if(n.offsetHeight<g_max_ad_container_height&&n.offsetHeight>=g_min_ad_container_height){e=n;break}}return e}function high_light_auto_fill(e){e&&(e.style.background="#E2ECFE",e.style.backgroundClip="border-box")}function set_input_text(e,t){e.value=t;t=document.createEvent("Events");t.initEvent("input",!0,!0),e.dispatchEvent(t)}function auto_fill_by_form_data(e){var t=e.id,n=e.name,o=e.placeholder;if("password"==e.type){var r=g_fill_form_data.password;if(r)return set_input_text(e,r),void high_light_auto_fill(e)}if(n){var r=g_fill_form_data[n];if(r)return set_input_text(e,r),void high_light_auto_fill(e)}if(t){n=g_fill_form_data[t];if(console.log(">>>>> fetch by id : "+n),n)return set_input_text(e,n),void high_light_auto_fill(e)}o&&(r=g_fill_form_data[o],console.log(">>>>> fetch by ph : "+r),r&&(set_input_text(e,r),high_light_auto_fill(e)))}function sync_auto_fill_data(){var e=JSON.stringify(g_fill_form_data);console.log(">>>>>> call sync_auto_fill_data function >>>>>>>>"+e),mbrowser.syncAutoFillFormData(document.location.host,e)}function sync_data_later(){g_timer&&clearTimeout(g_timer),g_timer=setTimeout(sync_auto_fill_data,1e3)}function can_auto_fill(e){if(e){if("hidden"==e.type)return!1;if("password"==e.type)return e._bind_event_password||(e.addEventListener("input",function(){g_fill_form_data.password=e.value,sync_data_later()}),e._bind_event_password=!0),!0;for(var t=0;t<g_auto_fill_keywords.length;t++){var n=g_auto_fill_keywords[t],o=e.name,r=e.id,l=e.placeholder;if(o&&0<=o.toLowerCase().indexOf(n))return e["_bind_event_"+o]||(console.log("==== bind envent ==========="),e.addEventListener("input",function(){g_fill_form_data[o]=e.value,sync_data_later()}),e["_bind_event_"+o]=!0),!0;if(r&&0<=r.toLowerCase().indexOf(n))return e["_bind_event_"+r]||(e.addEventListener("input",function(){g_fill_form_data[r]=e.value,sync_data_later()}),e["_bind_event_"+r]=!0),!0;if(l&&0<=l.toLowerCase().indexOf(n))return e._bind_event_placeholder||(e.addEventListener("input",function(){g_fill_form_data[l]=e.value,sync_data_later()}),e._bind_event_placeholder=!0),!0}}return!1}function auto_fill_form(){var e=document.querySelectorAll("input");console.log("======== total input element:total "+e.length);for(var t=0;t<e.length;t++){var n=e[t];can_auto_fill(n)&&(console.log("======== found can auto fill input =========="+n.name),auto_fill_by_form_data(n))}}function traverseDom(e,t){for(var n=[],o=(n.push(e),1),r=0;r<o;r++)if("A"!=(e=n[r]).tagName&&e.className.indexOf("code")<0){var l=e.childNodes,a=l.length,c=o,i=0;if(a>e.childElementCount)for(;i<a;i++){var s=l[i];if(3==s.nodeType){var _=s.textContent;if(/\S/.test(_)&&8<_.length){o=c,e.style.maxWidth=t+"px";break}}else null!=s.tagName&&(n.push(s),o++)}}}function nav_call_text_auto_fit(t){[].forEach.call(window.frames,function(e){try{traverseDom(window.frames[0].document.body,t)}catch(e){}}),traverseDom(document.body,t)}var g_ctx_menu_cmd=[];function nav_call_exec_menu_cmd(e){for(var t=0;t<g_ctx_menu_cmd.length;t++){console.log("============ total command: =========="+g_ctx_menu_cmd.length);var n=g_ctx_menu_cmd[t];n.title==e&&(console.log("============exec call GM command =========="+e+" callback:"+n.callback),n.callback())}}var g_gm_callback_map={};function nav_call_exec_gm_callback(e,t){var n,o=g_gm_callback_map[e];o&&("GM_xmlhttpRequest"==(t=JSON.parse(t)).methodName&&("arraybuffer"==t.responseType?t.response=_base64ToArrayBuffer(t.response_base64):"blob"==t.responseType&&(n=_base64ToArrayBuffer(t.response_base64),t.response=new Blob([n])),console.log(">>>> callbackId:"+e+" responseType:"+t.responseType+" callback: "+t.callbackName)),(n=o[t.callbackName])&&n(t))}function _base64ToArrayBuffer(e){for(var t=window.atob(e),n=t.length,o=new Uint8Array(n),r=0;r<n;r++)o[r]=t.charCodeAt(r);return o.buffer}var TKK="406398.2087938574";function _b(e,t){for(var n=0;n<t.length-2;n+=3){o="a"<=(o=t.charAt(n+2))?o.charCodeAt(0)-87:Number(o);var o="+"==t.charAt(n+1)?e>>>o:e<<o;e="+"==t.charAt(n)?e+o&4294967295:e^o}return e}function _tk(e){for(var t=TKK.split("."),n=Number(t[0])||0,o=[],r=0,l=0;l<e.length;l++){var a=e.charCodeAt(l);a<128?o[r++]=a:(a<2048?o[r++]=a>>6|192:(55296==(64512&a)&&l+1<e.length&&56320==(64512&e.charCodeAt(l+1))?(a=65536+((1023&a)<<10)+(1023&e.charCodeAt(++l)),o[r++]=a>>18|240,o[r++]=a>>12&63|128):o[r++]=a>>12|224,o[r++]=a>>6&63|128),o[r++]=63&a|128)}for(e=n,r=0;r<o.length;r++)e=_b(e+=o[r],"+-a^+6");return e=_b(e,"+-3^+b+-f"),(e^=Number(t[1])||0)<0&&(e=2147483648+(2147483647&e)),(e%=1e6).toString()+"."+(e^n)}function needInjectCss(){return mbrowser.needInjectCss()&&document.location.href.indexOf("article_list_for_xb_readmode")<0}function applyToDesktopMode(e){var t=document.querySelector('meta[name="viewport"]');t&&(t.content=e?"width=1280":"width=device-width,initial-scale=1.0")}function _main_(){alert("not found _main_() function")}function _x_inject_script(e){var t=document.getElementsByTagName("head").item(0),n=document.createElement("script");return n.type="text/javascript",n.src=e,t&&t.appendChild(n),n}function mylog(e){}function googleTranslateElementInit(){_getCookie("googtrans")||_setCookie("googtrans","/auto/"+mbrowser.getTranLang()),new google.translate.TranslateElement({pageLanguage:"auto"},"google_translate_element"),mbrowser.showToast(mbrowser.getStringResource("toast_perform_page_tran"))}function inject_google_trans_widget(){var e,t=document.getElementsByTagName("body").item(0);document.querySelector("#google_translate_element")?googleTranslateElementInit():((e=document.createElement("div")).id="google_translate_element",t.appendChild(e),(e=document.createElement("script")).type="text/javascript",e.src=mbrowser.getGoogleTranUrl(),t.appendChild(e))}function stop_timer(){for(var e=setInterval(null,1e4),t=0;t<=e;t++)clearInterval(t)}function touch(e){e=e||window.event;if(!mbrowser.isInMarkAdMode()||!e)return!1;e.preventDefault()}function execute_rules(){var e=window.location.host;""==e||mbrowser.inWhiteList(e)||(execute_element_rules(),execute_mark_rules())}function execute_rules_later(){var e=window.location.host;""==e||mbrowser.inWhiteList(e)||setTimeout(execute_mark_rules,300)}function execute_auto_fill(){var e;""!=window.location.host&&mbrowser.isAllowAutoFillOnDomain(window.location.host)&&(e=mbrowser.loadAutoFillFormData(window.location.host),(g_fill_form_data=JSON.parse(e)).constructor==Array&&(g_fill_form_data={}),auto_fill_form())}function execute_auto_fill_later(){setTimeout(execute_auto_fill,600)}function check_user_script(){try{document.location.pathname.endsWith(".js")&&0<=document.body.textContent.indexOf("// ==UserScript==")&&mbrowser.notifyFoundUserScript(document.location.href)}catch(e){console.log("========  check user script execute failed =========="+e.message)}}function disableClipboard(){g_f_exec_command=document.execCommand,g_f_cb_write=navigator.clipboard.write,g_f_cb_write_text=navigator.clipboard.writeText,document.execCommand=()=>{},navigator.navigator.clipboard.write=()=>{},navigator.clipboard.writeText=()=>{}}function enableClipboard(){document.execCommand=g_f_exec_command,navigator.navigator.clipboard.write=g_f_cb_write,navigator.clipboard.writeText=g_f_cb_write_text}needInjectCss()&&(applyOuterCSS(),mbrowser.onOuterCSSApplied()),mbrowser.adBlockActived(),execute_auto_fill_later(),appExtraCss(),console.log("============  start install nightmode js ==================="),mbrowser.isInMarkAdMode&&window.addEventListener("touchend",touch,!1),document.addEventListener("DOMContentLoaded",function(){console.log("============ dom load finished =============");for(var e=document.querySelectorAll("iframe"),t=0;t<e.length;t++)e[t].setAttribute("allowfullscreen",!0);mbrowser.onDOMContentLoaded(),needInjectCss()&&(applyOuterCSS(),mbrowser.onOuterCSSApplied()),sniff_video(),g_dom_load_finished=!0,mbrowser.adBlockActived()&&execute_rules()},!1),window.addEventListener("load",function(){console.log("============ page load finished ============="),mbrowser.onPageLoaded(),g_page_load_finished=!0,console.log("============  page load on night ==================="),mbrowser.inNightMode()&&applyOuterCSS(),sniff_video(),execute_auto_fill(),mbrowser.adBlockActived()},!1),document.onselectionchange=function(){var e,t=window.getSelection().toString();t&&0<t.length?(in_selection=!0,e=_tk(t),mbrowser.onSelectTextChange(t,e)):(console.log("in_selection:"+in_selection),1==in_selection&&(in_selection=!1,mbrowser.onSelectTextChange(t,"")))};