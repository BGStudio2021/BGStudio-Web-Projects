function fileType2font(e){return 1==e?"icon-dir":2==e?"icon-video":3==e?"icon-music":4==e?"icon-mht":5==e?"icon-html":6==e?"icon-apk":7==e?"icon-img":8==e?"icon-word":9==e?"icon-pdf":10==e?"icon-zip":"icon-file"}function native_call_delete_host(e){for(var t=document.querySelectorAll("li"),i=0;i<t.length;i++){var o=t[i];if(o.getAttribute("host")==e){o.parentNode.removeChild(o);break}}}function loadHostList(e){var t,o=document.querySelector("#host-list");if(o)for(o.innerHTML="",hosts=JSON.parse(mbrowser.getHosts(e)),i=0;i<hosts.length;i++)item=document.createElement("li"),item.setAttribute("class","table-view-cell my-cell"),item.setAttribute("host",hosts[i].host),2==e?item.innerHTML='<span class="item-icon pull-left iconfont icon-browser"></span><div class="media-body">'+hosts[i].host+"<p>"+mbrowser.getUATitleByHost(hosts[i].host)+'</p></div><button onclick="mbrowser.removeDomain('+e+",'"+hosts[i].host+'\')" class="btn pull-right">'+mbrowser.getStringResource("web_str_btn_delete")+"</button>":6==e?(t="<span  onclick=\"mbrowser.showAutoFillContextMenu('"+hosts[i].host+'\')" class="x-more-btn pull-right  icon icon-more-vertical"></span>',item.innerHTML='<span class="item-icon pull-left iconfont icon-browser"></span><div class="x-icon">'+hosts[i].host+"</div>"+t):item.innerHTML='<span class="item-icon pull-left iconfont icon-browser"></span><div class="x-icon">'+hosts[i].host+'</div><button onclick="mbrowser.removeDomain('+e+", '"+hosts[i].host+'\')" class="btn pull-right">'+mbrowser.getStringResource("web_str_btn_delete")+"</button>",o.appendChild(item)}function sync_menu_conf(e,t){for(var i=0;i<e.length;i++)e[i].id==t.id&&(e[i]=t);console.log(JSON.stringify(e))}function saveMenuConfig(e,t){var i=[];if(t){for(var o=0;o<t.childElementCount;o++){var s=t.children[o],n={},s=(n.id=s.getAttribute("item-id"),n.title=s.getAttribute("item-title"),s.querySelector("input"));n.active=s.checked,n.order=o,i.push(n)}console.log(JSON.stringify(i)),mbrowser.saveMenuConfig(e,JSON.stringify(i))}}function loadMenuConf(t){var e=document.querySelector("#main-content"),i=document.createElement("ul");if(e){e.innerHTML="",i.setAttribute("class","table-view my-list"),e.appendChild(i),confItems=JSON.parse(mbrowser.getMenuConfig(t)),console.log("length:"+confItems.length);for(var o,s,n=0;n<confItems.length;n++)"setting"!=confItems[n].id&&"exit"!=confItems[n].id&&((o=document.createElement("li")).setAttribute("class","table-view-cell my-cell"),s=confItems[n].active?"checked":"",o.innerHTML='<div class="media-body">'+confItems[n].title+"<input "+s+' class="pull-right"  type="checkbox"></div><span class="instant"></span>',i.appendChild(o),o.setAttribute("item-title",confItems[n].title),o.setAttribute("item-id",confItems[n].id),(s=o.querySelector("input"))&&s.addEventListener("click",function(e){this.parentNode.setAttribute("item-active",this.checked),saveMenuConfig(t,i)}))}return i}function updateNodeName(e){var t=document.querySelector("#node-name");null!=t&&(t.innerHTML="当前上网节点("+e+")")}function checkPrivFlowNote(){mbrowser.hasFreePrivilegeFlow()||(document.write('<li class="table-view-cell media">'),document.write("<a>"),document.write('<span class="media-object pull-left icon icon-info"></span>'),document.write('<div class="media-body">'),document.write('抱歉，您的"特权流量"已经使用完了。'),document.write("</div>"),document.write("</a>"),document.write('<a href="javascript:mbrowser.openLocalPage(\'x:priv\');" class="btn btn-primary">详情</a>'),document.write("</li>"),document.write('<li class="table-view-divider"></li>'))}function knownTip(e){var t=document.querySelector("#_tip_"+e);t&&(t.parentNode.removeChild(t),mbrowser.iKnwonTip(e))}function checkTips(e){mbrowser.hasKnownTip(e)||(document.write('<ul id="_tip_'+e+'" class="table-view">'),document.write('<li  class="table-view-cell media">'),document.write('<span class="media-object pull-left icon icon-info"></span>'),document.write('<div class="media-body">'),document.write("<p>"+mbrowser.getTipMessage(e)+"</p>"),document.write("</div>"),document.write("<span onclick='knownTip("+e+')\' class="x-close pull-right pull-top icon icon-close"></span>'),document.write("</li>"),document.write("</ul>"))}function clearLogs(){document.getElementById("log-list").innerHTML="",mbrowser.removeAllEventLogs()}function enable_listen_scroll(){var e;document.getElementById("style-enable-listen-scroll")||((e=document.createElement("style")).type="text/css",e.rel="stylesheet",e.id="style-enable-listen-scroll",e.appendChild(document.createTextNode("body, .content, #app-container { position: static; }  .content { -webkit-overflow-scrolling: auto; }")),null!=document.documentElement&&document.documentElement.appendChild(e))}function loadEventLogs(){if(list=document.querySelector("#log-list"),list)for(logs=JSON.parse(mbrowser.getLogs()),i=0;i<logs.length;i++)item=document.createElement("li"),item.setAttribute("class","table-view-cell"),item.innerHTML='<div class="media-body">'+logs[i].event_message+"<p>"+logs[i].create_at+"</p></div>",list.appendChild(item)}function loadResourceList(e,t){var o=document.querySelector("#res-list");if(o){var s=JSON.parse(mbrowser.getResourceListWithJson(e,t));for(i=0;i<s.length;i++){item=document.createElement("li"),item.setAttribute("id",s[i].id),item.setAttribute("class","table-view-cell my-cell");var n=s[i].url.replace(/[\?&]_res_tag_=[a-z]*/,"");s[i].block_host?item.innerHTML=item.innerHTML="<a href=\"javascript:mbrowser.openUrlOnNewTab('"+n+'\',32)"><span style="text-decoration: line-through">'+s[i].host+'</span><div class="media-body"><p style="word-wrap: break-word;text-decoration: line-through">'+decodeURI(n)+"</p></div></a><span onclick=\"mbrowser.showResourceContextMenu('"+n+"','"+s[i].id+"','"+e+"','"+t+'\')" class="x-more-btn pull-right pull-top icon icon-more-vertical"></span>':s[i].block_url?item.innerHTML=item.innerHTML="<a href=\"javascript:mbrowser.openUrlOnNewTab('"+n+"',32)\"><span>"+s[i].host+'</span><div class="media-body"><p style="word-wrap: break-word;text-decoration: line-through">'+decodeURI(n)+"</p></div></a><span onclick=\"mbrowser.showResourceContextMenu('"+n+"','"+s[i].id+"','"+e+"','"+t+'\')" class="x-more-btn pull-right pull-top icon icon-more-vertical"></span>':item.innerHTML="<a href=\"javascript:mbrowser.openUrlOnNewTab('"+n+"',32)\"><span>"+s[i].host+'</span><div class="media-body"><p style="word-wrap: break-word;">'+decodeURI(n)+"</p></div></a><span onclick=\"mbrowser.showResourceContextMenu('"+n+"','"+s[i].id+"','"+e+"','"+t+'\')" class="x-more-btn pull-right pull-top icon icon-more-vertical"></span>',o.appendChild(item)}}}function native_call_update_res_by_id(e,t,i){var o,e=document.getElementById(e);e&&(o=e.querySelector("span"),e=e.querySelector("p"),0==i?t?(o.style.textDecoration="line-through",e.style.textDecoration="line-through"):(o.style.textDecoration="",e.style.textDecoration=""):t?e.style.textDecoration="line-through":(o.style.textDecoration="",e.style.textDecoration=""))}function getQueryString(e){e=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),e=window.location.search.substr(1).match(e);return null!=e?decodeURI(e[2]):null}function native_call_delete_node_by_id(e){e=document.getElementById(e);e&&e.parentNode.removeChild(e)}function native_call_set_cut_sate(e,t){e=document.getElementById(e);e&&(t?(e.style.opacity="0.3",e.old_padding=e.style.padding,e.style.backgroundColor=e.origin_bg):e.style.opacity="1")}function loadHistories(e,t,i){var o=document.querySelector(".content"),s=(0==i&&(o.innerHTML=""),JSON.parse(mbrowser.getHistories(e,t,i)));if(0<s.length){for(var n=document.createElement("ul"),r=(n.setAttribute("id","his-list"),n.setAttribute("class","table-view"),null),l=0;l<s.length;l++){null!=r&&r==s[l].last_visit||(r=s[l].last_visit,(a=document.createElement("li")).setAttribute("class","table-view-divider"),a.innerHTML="<span>"+r+"</span>",n.appendChild(a));var a=document.createElement("li");a.setAttribute("id",s[l].id),a.setAttribute("data-title",s[l].title),a.setAttribute("data-url",s[l].url),a.setAttribute("data-type","0"),a.setAttribute("class","table-view-cell-ex"),a.innerHTML="<a href=javascript:mbrowser.openUrl('"+s[l].url+'\',0,true)><span class="item-icon pull-left"><img   width="16" height="16" src="'+s[l].icon_uri+'"/></span><div class="media-body">'+s[l].title+"<p>"+extractUrlHost(s[l].url)+"</p></div></a>",n.appendChild(a)}o.appendChild(n)}else{e=document.createElement("div");e.setAttribute("class","content-placeholder"),e.innerHTML="No Data",o.appendChild(e)}}function native_call_clearHistories(){var e=document.querySelector(".content");e&&(e.innerHTML="")}function native_call_clearHosts(){document.getElementById("host-list").innerHTML=""}function setCheckedState(e,t){t?(e.style.opacity="0.3",e.old_bg=e.style.backgroundColor,e.origin_bg=e.style.backgroundColor,e.style.backgroundColor="#2f70d4"):(e.style.opacity="1",e.style.backgroundColor=e.old_bg)}function native_call_batch_delete_bm(){var e=document.querySelector("#bm-list");if(e){var t=e.querySelectorAll("li"),i=0;for(j=0;j<t.length;j++){var o=t[j];o.checked&&(i++,mbrowser.deleteBookmark(o.getAttribute("item-url")),o.parentElement.removeChild(o))}0<j&&mbrowser.totalBookmarkDeleted(i)}}function native_call_select_all_bm(){var e=document.querySelector("#bm-list");if(e){var t=e.querySelectorAll("li");for(j=0;j<t.length;j++){var i=t[j];i.checked?(i.checked=!1,setCheckedState(i,!1)):(i.checked=!0,setCheckedState(i,!0))}}}function native_call_clean_checked_items(){var e=document.querySelector("#bm-list");if(e){var t=e.querySelectorAll("li");for(j=0;j<t.length;j++){var i=t[j];i.checked&&(i.checked=!1,setCheckedState(i,!1))}}}function native_call_batch_cut_bm(){var e=document.querySelector("#bm-list");if(e){var t=e.querySelectorAll("li");for(j=0;j<t.length;j++){var i=t[j];i.checked&&(native_call_set_cut_sate(i.id,!0),mbrowser.cutBookmark(i.getAttribute("item-url")))}}}function extractUrlHost(e){if(e.indexOf("://")){var t=e.split("/");if(t[2])return t[2]}return e}function loadBookmarks(e,t,i){var o=document.querySelector("#list-container"),s=(o.innerHTML="",JSON.parse(mbrowser.getBookmarks(e,t,i)));if(0<s.length){var n=document.createElement("ul");n.setAttribute("class","table-view"),n.setAttribute("id","bm-list");for(var r=0;r<s.length;r++){var l,a,c=document.createElement("li");c.setAttribute("item-order",s[r].item_order),c.setAttribute("id",s[r].id),c.setAttribute("data-title",s[r].title),c.setAttribute("item-url",s[r].url),c.setAttribute("timestamp",s[r].timestamp),c.checked=!1,c.onclick=function(e){mbrowser.isInMultiSelectMode()&&(this.checked?(setCheckedState(this,!1),this.checked=!1):(setCheckedState(this,!0),this.checked=!0),e.preventDefault())},0==s[r].type?(c.setAttribute("data-url",s[r].url),c.setAttribute("data-type","0"),c.setAttribute("class","table-view-cell-ex"),c.innerHTML="<a href=\"javascript:mbrowser.openUrl('"+s[r].url+'\',0,true)"> <span class="item-icon pull-left"><img   width="16" height="16" src="'+s[r].icon_uri+'"/></span><div class="media-body">'+s[r].title+"<p>"+extractUrlHost(s[r].url)+"</p></div></a></div>"):1==s[r].type&&(l="navigate-right",4==(4&s[r].status)&&(l="navigate-right-with-lock"),a="x:bm?path="+s[r].url+"&sort="+i,a="<a href=\"javascript:open_bookmark_dir('"+s[r].id+"','"+a+'\')" class="'+l+'"> <span class="media-object pull-left x-icon iconfont icon-dir"></span><div class="x-icon">'+s[r].title+"</div></a></div>",c.setAttribute("data-url",s[r].url),c.setAttribute("data-type","1"),c.setAttribute("class","table-view-cell-ex"),c.innerHTML=a),c.setAttribute("data-status",s[r].status),n.appendChild(c)}o.appendChild(n)}else{e=document.createElement("div");e.setAttribute("class","content-placeholder"),e.innerHTML="No Data",o.appendChild(e)}return s.length}function syncBookmarkDomNodeOrder(e){var t=document.querySelector("#bm-list");if(t){var o=JSON.parse(mbrowser.getBookmarks("",e,"default"));for(i=0;i<o.length;i++){var s=t.querySelectorAll("li");for(j=0;j<s.length;j++)o[i].url==s[j].getAttribute("data-url")&&(console.log("item-order do sync order from "+s[j].getAttribute("item-order")+" dest:"+o[i].item_order),s[j].setAttribute("item-order",o[i].item_order))}}}function dumpBookmarkDomNodeOrder(){var e=document.querySelector("#bm-list");if(e){var t=e.querySelectorAll("li");for(j=0;j<t.length;j++)console.log("item-order li item-order:"+t[j].getAttribute("item-order"))}}function native_call_update_bm_mode(e,t,i,o){for(var s=document.querySelectorAll("li"),n=0;n<s.length;n++){var r=s[n];if(r.getAttribute("data-url")==i){r.setAttribute("data-url",t),r.innerHTML=1==o?'<a href="x:bookmark?path='+t+'"  class="navigate-right"> <span class="media-object pull-left x-icon iconfont icon-dir"></span><div class="x-icon">'+e+"</div></a>":"<a href="+t+'> <span class="item-icon pull-left x-icon icon icon-star"></span><div class="media-body">'+e+"<p>"+t+"</p></div></a>";break}}}function sayHello(){alert("hello")}function _str(e){document.write(mbrowser.getStringResource(e))}function do_dl_action(e){var t=JSON.parse(mbrowser.getDownloadInfo(e)),t=(t.status<2||4<t.status?mbrowser.pauseDownload(e):2==t.status?mbrowser.resumeDownload(e):3==t.status?mbrowser.showDownloadContextMenu(e):4==t.status&&mbrowser.resumeDownload(e),window.event);t&&t.stopPropagation()}function loadDownloads(){if(list=document.querySelector("#dl-list"),list.innerHTML="",list)for(downloads=JSON.parse(mbrowser.loadDownloads()),i=0;i<downloads.length;i++){item=document.createElement("li"),item.setAttribute("class","table-view-cell dl-item my-cell"),item.setAttribute("id",downloads[i].download_id),console.log("file type:"+downloads[i].file_type);var e="<span onclick=\"do_dl_action('"+downloads[i].download_id+'\')" class="x-more-btn pull-right  icon icon-pause"></span>';3==downloads[i].status&&(e="<span  onclick=\"do_dl_action('"+downloads[i].download_id+'\')" class="x-more-btn pull-right  icon icon-more-vertical"></span>'),item.innerHTML='<span class="x-left-icon pull-left iconfont '+fileType2font(downloads[i].file_type)+' "></span><div class="media-body"><div class="dl-title">'+downloads[i].fileName+'</div><div class="progress-bar" ></div><div class="dl-status"><span class="dl-so-far pull-left"></span><span class="dl-speed pull-right"></span></div>'+e+"</div>",list.appendChild(item)}}function native_call_clearDownloads(){document.getElementById("dl-list").innerHTML=""}function updateProgress(){var e=document.getElementsByClassName("table-view-cell"),t=document.getElementsByClassName("progress-bar"),u=document.getElementsByClassName("dl-title"),m=document.getElementsByClassName("dl-so-far"),p=document.getElementsByClassName("dl-speed"),b=document.getElementsByClassName("x-more-btn");for("undefined"==typeof bars&&(bars=[]),i=0;i<e.length;i++){var o,s=e[i],n=s.getAttribute("id"),n=JSON.parse(mbrowser.getDownloadInfo(n)),r=t[i],l=b[i],a=(u[i],m[i]),c=p[i],d=(void 0===bars[i]&&(bars[i]=new Progress.bar({id:"progress"+i,autoRemove:!0,backgroundSpeed:5,type:"charge",showPercentage:!0})),bars[i]);(n.status<=2||4<=n.status)&&(d.renderTo(r),o=0==n.total?0:parseInt(n.downloaded/n.total*100),d.update(o)),3==n.status?s.onclick=function(){mbrowser.openDownload(this.getAttribute("id"))}:s.onclick=null,l.classList.remove("icon-pause"),l.classList.remove("icon-more-vertical"),l.classList.remove("icon-play"),0==n.status?(l.classList.add("icon-pause"),a.innerHTML=n.text_progress,c.innerHTML=mbrowser.getStringResource("web_str_dl_status_connecting"),r.style.display="inline"):5==n.status?(l.classList.add("icon-pause"),a.innerHTML=n.text_progress,c.innerHTML=mbrowser.getStringResource("web_str_dl_status_wait_wifi"),r.style.display="inline"):6==n.status?(l.classList.add("icon-pause"),a.innerHTML=n.text_progress,c.innerHTML=mbrowser.getStringResource("web_str_dl_status_waiting"),r.style.display="inline"):1==n.status?(l.classList.add("icon-pause"),a.innerHTML=n.text_progress,c.innerHTML=n.text_speed+"/s",r.style.display="inline"):2==n.status?(l.classList.add("icon-play"),a.innerHTML=n.text_progress,c.innerHTML=mbrowser.getStringResource("web_str_dl_status_pause"),r.style.display="inline"):3==n.status?(l.classList.add("icon-more-vertical"),r.style.display="none",a.innerHTML=n.text_total,c.innerHTML=mbrowser.getStringResource("web_str_dl_status_finish")):4==n.status&&(l.classList.add("icon-play"),r.style.display="inline",a.innerHTML=n.text_progress,c.innerHTML=mbrowser.getStringResource("web_str_dl_status_fail"))}setTimeout("updateProgress()",200)}var _count=0,progress_array=["🕛","🕐","🕑","🕒","🕓","🕔","🕕","🕖","🕗","🕘","🕚"];function nav_call_update_item_status(e,t,i){var e=document.querySelector("#"+e);!e||(e=e.querySelector(".dl-status"))&&(0!=i&&(-1==i||-4==i)?show_ascii_progress(e,"  "+mbrowser.getStringResource("web_str_status_importing")):e.innerHTML=t)}function nav_call_update_btn_status(e,t,i){var o=document.querySelector("#"+e);o&&(0==i?(o.innerHTML="sync-btn-push"==e?mbrowser.getStringResource("web_str_push_user_data"):mbrowser.getStringResource("web_str_pull_user_data"),o.disabled=!1):(o.disabled=!0,show_ascii_progress(o,"  "+mbrowser.getStringResource("web_str_status_synchronizing"))))}function show_ascii_progress(e,t){console.log(">>>>>>>>>>>>> call show_ascii_progress() >>>>>>>>>>>>>"),_count<progress_array.length?(e.innerHTML=progress_array[_count]+t,_count++):_count=0}function open_dialog(e){e=document.querySelector(e);e&&e.classList.contains("modal")&&e.classList.toggle("active")}function close_dialog(e){e=document.querySelector(e);e&&e.classList.contains("modal")&&e.classList.remove("active")}function open_lock_panel(){open_dialog("#dlg-lock-panel"),mbrowser.lockScroll(!0)}function close_lock_panel(){close_dialog("#dlg-lock-panel"),mbrowser.lockScroll(!1)}